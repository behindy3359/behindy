-- PostgreSQL 확장 설치
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- 시간대 설정
SET timezone = 'Asia/Seoul';

-- =====================================
-- 초기화 상태 추적 테이블 생성
-- =====================================
CREATE TABLE IF NOT EXISTS init_status (
    script_name VARCHAR(100) PRIMARY KEY,
    executed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    version VARCHAR(20) DEFAULT '1.0',
    description TEXT
);

-- =====================================
-- 기본 역 데이터 초기화
-- =====================================
DO $$
BEGIN
    -- 이미 초기화되었는지 확인
    IF NOT EXISTS (SELECT 1 FROM init_status WHERE script_name = 'station_data_v1.0') THEN

        -- 역 테이블이 존재할 때까지 대기 (JPA가 생성할 때까지)
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'sta') THEN

            -- 1호선 역 데이터
            INSERT INTO sta (api_station_id, sta_name, sta_line) VALUES
            ('1001000113', '도봉산', 1),
            ('1001000114', '도봉', 1),
            ('1001000115', '방학', 1),
            ('1001000116', '창동', 1),
            ('1001000117', '녹천', 1),
            ('1001000118', '월계', 1),
            ('1001000119', '광운대', 1),
            ('1001000120', '석계', 1),
            ('1001000121', '신이문', 1),
            ('1001000122', '외대앞', 1),
            ('1001000123', '회기', 1),
            ('1001000124', '청량리', 1),
            ('1001000125', '제기동', 1),
            ('1001000126', '신설동', 1),
            ('1001000127', '동묘앞', 1),
            ('1001000129', '종로5가', 1),
            ('1001000130', '종로3가', 1),
            ('1001000131', '종각', 1),
            ('1001000132', '시청', 1),
            ('1001000133', '서울역', 1),
            ('1001000134', '남영', 1),
            ('1001000135', '용산', 1),
            ('1001000136', '노량진', 1),
            ('1001000137', '대방', 1),
            ('1001000138', '신길', 1),
            ('1001000139', '영등포', 1),
            ('1001000141', '구로', 1),
            ('1001000142', '구일', 1),
            ('1001000143', '개봉', 1),
            ('1001000144', '오류동', 1),
            ('1001000145', '온수', 1),
            ('1001080142', '가산디지털단지', 1),
            ('1001080143', '독산', 1),
            ('1001000128', '동대문', 1),
            ('1001000140', '신도림', 1),

            -- 2호선 주요 역들
            ('1002000201', '시청', 2),
            ('1002000202', '을지로입구', 2),
            ('1002000205', '동대문역사문화공원', 2),
            ('1002000212', '건대입구', 2),
            ('1002000216', '잠실', 2),
            ('1002000219', '삼성', 2),
            ('1002000222', '강남', 2),
            ('1002000223', '교대', 2),
            ('1002000226', '사당', 2),
            ('1002000230', '신림', 2),
            ('1002000234', '신도림', 2),
            ('1002000239', '홍대입구', 2),
            ('1002000240', '신촌', 2),

            -- 3호선 주요 역들
            ('1003000301', '구파발', 3),
            ('1003000303', '불광', 3),
            ('1003000307', '독립문', 3),
            ('1003000310', '종로3가', 3),
            ('1003000328', '충무로', 3),
            ('1003000324', '옥수', 3),
            ('1003000323', '압구정', 3),
            ('1003000319', '교대', 3),
            ('1003000344', '양재', 3),
            ('1003000351', '수서', 3),
            ('1003000352', '오금', 3),

            -- 4호선 주요 역들
            ('1004000401', '당고개', 4),
            ('1004000411', '노원', 4),
            ('1004000412', '창동', 4),
            ('1004000420', '혜화', 4),
            ('1004000421', '동대문', 4),
            ('1004000423', '충무로', 4),
            ('1004000424', '명동', 4),
            ('1004000426', '서울역', 4),
            ('1004000433', '사당', 4)

            ON CONFLICT (api_station_id) DO NOTHING;

            -- 초기화 완료 기록
            INSERT INTO init_status (script_name, description)
            VALUES ('station_data_v1.0', '기본 역 데이터 초기화 완료');

            RAISE NOTICE '기본 역 데이터 초기화 완료: % 개 역', (SELECT COUNT(*) FROM sta);
        ELSE
            RAISE NOTICE 'STA 테이블이 아직 생성되지 않았습니다. JPA가 생성할 때까지 대기...';
        END IF;
    ELSE
        RAISE NOTICE '기본 역 데이터는 이미 초기화되었습니다';
    END IF;
END $$;